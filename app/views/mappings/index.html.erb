<% content_for(:page_title, "#{@site.default_host.hostname} Mappings") %>

<% breadcrumb(:mappings, @site) %>

<div class="page-title-with-border">
  <h1>
    <span class="small"><%= @site.default_host.hostname %></span>
    Mappings
  </h1>
</div>

<%= render partial: 'filters' %>

<h2>
  <%= pluralize(number_with_delimiter(@mappings.total_count), 'mapping') %>
</h2>

<% if @mappings.any? %>

  <%= paginate(@mappings) %>

  <% if current_user.can_edit?(@site.organisation) %>
    <div data-module="selectable-table">
  <% end %>
  <%= form_tag edit_multiple_site_mappings_path(@site), remote: true do %>
  <table class="mappings table table-bordered">
    <thead>
      <tr class="table-header">
        <% if current_user.can_edit?(@site.organisation) %>
          <th></th>
        <% end %>
        <th class="mapping-type-header" scope="col" style="width: 120px">
          <a href="#help" class="glyphicon glyphicon-question-sign link-muted pull-right" style="text-decoration: none" data-toggle="popover" data-content="
          <strong>High</strong>
          <p>Lorem ipsum dolor sit amet.</p>
          <strong>Medium</strong>
          <p>Lorem ipsum dolor sit amet.</p>
          <strong>Low</strong>
          <p>Lorem ipsum dolor sit amet.</p>
          " role="button" data-original-title="Traffic priority"></a>
          Type<br />
          <span class="text-muted">eg. redirect</span>
        </th>
        <th scope="col">
          Original path<br /><span class="text-muted">from <%= @site.default_host.hostname %></span>
        </th>
        <th scope="col" style="width: 150px">
          <a href="#help" class="glyphicon glyphicon-question-sign link-muted pull-right" style="text-decoration: none" data-toggle="popover" data-content="misc" role="button" data-original-title="Traffic priority"></a>

          Traffic&nbsp;priority<br />
          <span class="text-muted">hits per day</span>
        </th>
        <% if current_user.can_edit?(@site.organisation) %>
          <th></th>
        <% end %>
      </tr>
      <% if current_user.can_edit?(@site.organisation) %>
        <%= render partial: 'mappings_table_header', locals: {footer: false} %>
      <% end %>
    </thead>
    <tbody>
      <tr data-status-code="x">
        <td class="selectable-row">
          <div class="relative">
            <label>
              <input class="js-toggle-row" id="mapping_ids_" name="mapping_ids[]" type="checkbox" value="459173">
            </label>
          </div>
        </td>
        <td class="mapping-type-none">
          None
        </td>
        <td>
          <strong><a href="http://www.ukba.homeoffice.gov.uk/sitecontent/applicationforms/asylum/hpdlform.pdf" class="breakable">/sitecontent/applicationforms/asylum/hpdlform.pdf</a></strong>
        </td>
        <td>
          High<br>
          <span class="text-muted">14,359</span>
        </td>
        <td class="text-right">
          <a href="/sites/ukba/mappings/459173/edit" class="btn btn-default btn-xs">
            Edit
          </a>
        </td>
      </tr>
      <tr data-status-code="x">
        <td class="selectable-row">
          <div class="relative">
            <label>
              <input class="js-toggle-row" id="mapping_ids_" name="mapping_ids[]" type="checkbox" value="459173">
            </label>
          </div>
        </td>
        <td class="mapping-type-pending">
          Pending<br />content
        </td>
        <td>
          <strong><a href="http://www.ukba.homeoffice.gov.uk/sitecontent/applicationforms/asylum/hpdlform.pdf" class="breakable">/sitecontent/applicationforms/nothing/here/hpdlform234.pdf</a></strong>
          <br /><span class="text-muted">pending</span>
          <a href="https://whitehall-admin.preview.alphagov.co.uk/government/admin/consultations/13691" class="link-muted">https://whitehall-admin.preview.alphagov.co.uk/government/admin/consultations/13691</a>
        </td>
        <td>
          High<br>
          <span class="text-muted">14,359</span>
        </td>
        <td class="text-right">
          <a href="/sites/ukba/mappings/459173/edit" class="btn btn-default btn-xs">
            Edit
          </a>
        </td>
      </tr>
    <% @mappings.each do |mapping| %>
      <tr data-status-code="<%= mapping.http_status %>">
        <% if current_user.can_edit?(@site.organisation) %>
          <td class="selectable-row">
            <div class="relative">
              <label>
                <%= check_box_tag "mapping_ids[]", mapping.id, checked = false, class: 'js-toggle-row' %>
              </label>
            </div>
          </td>
        <% end %>
        <td class="<%= "mapping-type-#{mapping.type}" %>">
          <%= mapping.type.titleize %>
        </td>
        <td>
          <strong><%= link_to mapping.path, mapping.old_url, class: 'breakable' %></strong>
          <% if mapping.redirect? %>
            <br><span class="text-muted">redirects to</span>
            <%= link_to mapping.new_url, mapping.new_url, class: 'link-muted breakable' if mapping.new_url.present? %>
          <% end %>
          <br><a href="#" class="tag">content:thing</a> <a href="#" class="tag">content:oh</a>
        </td>
        <td>
          <!-- <span class="glyphicon glyphicon-stats"></span> -->
          <%
            x = rand(0..2)
            y = rand(0..200000)

            case x
              when 0
                p = "High"
              when 1
                p = "Medium"
              when 2
                p = "Low"
            end
          %>
          <%= p %><br />
          <span class="text-muted"><%= number_with_delimiter(y) %></span>
        </td>
        <% if current_user.can_edit?(@site.organisation) %>
          <td class="text-right">
            <%= link_to edit_site_mapping_path(@site, mapping), class: 'btn btn-default btn-xs' do %>
              Edit
            <% end %>
          </td>
        <% end %>
      </tr>
    <% end %>
    </tbody>
    <% if current_user.can_edit?(@site.organisation) %>
      <tfoot class="if-no-js-hide">
        <%= render partial: 'mappings_table_header', locals: {footer: true} %>
      </tfoot>
    <% end %>
  </table>
  <% end %>
  <% if current_user.can_edit?(@site.organisation) %>
    </div>
    <script>GOVUK.SelectableTable.setup()</script>
  <% end %>

  <%= paginate(@mappings) %>

<% else %>
  <% if current_user.can_edit?(@site.organisation) %>
    <div class="add-bottom-margin">
      <%= render partial: 'add_button' %>
    </div>
  <% end %>
  <p class="no-content no-content-bordered">
    No mappings found
  </p>
<% end %>

<script>
  $('[data-toggle="tooltip"]').tooltip();
  $('[data-toggle="popover"]').popover({placement: 'left', html: true});
</script>
